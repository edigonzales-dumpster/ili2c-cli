plugins {
    id 'java'
    id 'application'
}

repositories {
    jcenter()
    maven { url 'http://jars.interlis.ch' }    
}

//version '5.1.2'+System.getProperty('release','-SNAPSHOT')
version '5.1.1'
archivesBaseName = 'ili2c-cli-thin'

dependencies {
    implementation 'ch.interlis:ili2c-core:5.1.1'
    implementation 'ch.interlis:ili2c-tool:5.1.1'
    implementation 'info.picocli:picocli:4.4.0'
    implementation 'info.picocli:picocli-codegen:4.4.0'
    annotationProcessor 'info.picocli:picocli-codegen:4.4.0'

    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.6.2'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.6.2'
}

compileJava {
    options.compilerArgs += ["-Aproject=${project.name}"]
}

application {
    mainClassName = 'ch.so.agi.ili2c.App'
}

test {
    useJUnitPlatform()
}

task fatjar(type: Jar) {
    archiveFileName='ili2c-cli-'+version+'.jar'
    manifest {
        attributes(
            "Main-Class": "ch.so.agi.ili2c.App"
        )
    }
    from sourceSets.main.output
    dependsOn configurations.runtimeClasspath
    from {
        configurations.runtimeClasspath.findAll { it.name.endsWith('jar') }.collect { zipTree(it) }
    }
}
